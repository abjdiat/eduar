<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arabic Learning Game</title>
    <style>
        body {
            text-align: center;
            font-family: 'DroidArabicNaskhRegular', sans-serif;
            background-color: #c2c6b3;
            margin: 0;
            padding: 10px;
            touch-action: manipulation; /* Prevents zooming while dragging */
        }

        .container {
            display: flex;
            flex-direction: row-reverse; /* Arabic alignment */
            justify-content: space-around;
            align-items: flex-start;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 20px;
        }

        ul {
            list-style: none;
            padding: 0;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        li {
            font-size: 1.5rem;
            width: 120px;
            height: 60px;
            line-height: 60px;
            background: #dad295;
            border: 4px solid #717845;
            border-radius: 10px;
            cursor: grab;
            user-select: none;
            touch-action: none; /* Required for mobile drag script */
        }

        #images {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        img {
            width: 120px;
            height: 120px;
            border: 8px solid #484111;
            border-radius: 15px;
            background: #3A6F9A;
            object-fit: cover;
        }

        /* Mobile specific adjustments */
        @media (max-width: 600px) {
            li { width: 100px; font-size: 1.2rem; }
            img { width: 100px; height: 100px; }
        }
    </style>
</head>

<body>

<audio id="myAudio"><source src="bravo.m4a" type="audio/mpeg"></audio>
<audio id="myAudio2"><source src="error.m4a" type="audio/mpeg"></audio>

<div class="container">
    <ul id="animals"></ul>
    <div id="images"></div>
</div>

<script>
var alphabet = "أبجدهوزحطيكلمنسعفصقرشتثخذضظغ".split('');
var randl = Math.floor(Math.random() * alphabet.length);

var animals_en = ["horse","sheep","camel","wolf","fish","snake","kangaroo","penguin","bear","dog","duck","cat","turkey","fox","mouse","goat","shrimp","elephant","giraffe","frog","ant","owl","donkey","chicken","bee","tiger","turtle","banana","apple","cherry","lemon","grapes","tomatoes","onion","pepper","orange","eggplant","watermelon","carrots","corn","cow","candle","bag","strawberry","keys","arrow","cup","ball","car","ship","truck","train","airplane","notebook","book","boy","girl","grandfather","grandmother","father","mother","nose","mouth","eye","sun","moon",'luna',"cloud","umbrella","shoe","camera","cactus","pen","flag","table","hat","nut","doctor","teacher","chef","cop","engineer","castle","bucket","think","lie","jump","red","white","black","pink","leaf","gift","box","jump","swim","paint","hold","pull","sleep","throw","walk","climb","push","sit","shell","right","left","hair","door","one","two","three","four","five","six","seven","eight","nine","milk","juice","court","blanket","drum","butterfly","garden","run","write","water","drive","kick","eat","knife","knock","flowers",'envelope',"nail","gazelle","darkness","cucumber","digger","ring","rock","hoopoe","lamp","tongue","meat","melody","river","button","butter","tooth","pyramid","gold","bandage","tail","crow","submarine","forest","sand","leg","pomegranate","laugh","lock","seal","crab"];
var animals_ar = ["حِصَانٌ","خروف","جمل","ذئب","سمكة","ثعبان","كنغر","بطريق","دب","كلب","بطة","قطة","ديك","ثعلب","فأر","معزة","ربيان","فيل","زرافة","ضفدع","نملة","بومة","حمار","دجاجة","نحلة","نمر","سلحفاة","موز","تفاح","كرز","ليمون","عنب","طماطم","بصل","فلفل","برتقال","باذنجان","بطيخ","جزر","ذرة","بقرة","شمعة","كيس","فراولة","مفاتيح","سهم","كوب","كرة","سيارة","سفينة","شاحنة","قطار","طائرة","دفتر","كتاب","ولد","بنت","جد","جدة","أب","أم","أنف","فم","عين","شمس","قمر",'هلال',"غيمة","مظلة","حذاء","كامرا","صبار","قلم","علم","طاولة","قبعة","جوز","طبيب","معلمة","طباخ","شرطي","مهندس","قلعة","دلو","يفكر","تكذب","تقفز","أحمر","أبيض","أسود","وردي","ورقة","هدية","صندوق","يقفز","يسبح","يلون","يمسك","يسحب","ينام","يرمي","يمشي","يتسلق","يدفع","يجلس","صدفة","يمين","يسار","شعر" ,"باب" ,"واحد","اثنان","ثلاثة","أربعة","خمسة","ستة","سبعة","ثمانية","تسعة","حليب","عصير","ملعب","بطانية","طبل","فراشة","حديقة","يجري","تكتب","تسقي","تقود","تركل","تأكل","سكين","يطرق","زهور","ظرف","ظفر","ظبي","ظلام","خيار","خنجر","خاتم","صخرة","هدهد","لمبة","لسان","لحمة","لحن","نهر","زر","زبدة","ضرس","هرم","ذهب","ضماد","ذيل","غراب","غواصة","غابة","رمل","رجل","رمان","ضحك","قفل","فقمة","سرطان"];

function shuffle(array) {
    return array.sort(() => Math.random() - 0.5);
}

// Filter words by random letter
let pool = [];
for(let i=0; i<animals_ar.length; i++) {
    if(animals_ar[i][0] === alphabet[randl]) {
        pool.push({ ar: animals_ar[i], en: animals_en[i] });
    }
}

// Fallback if no words start with that letter
if(pool.length < 4) {
    pool = [];
    for(let i=0; i<4; i++) pool.push({ ar: animals_ar[i], en: animals_en[i] });
}

shuffle(pool);
let selected = pool.slice(0, 4);

// Create randomized lists
let wordOrder = shuffle([...selected]);
let imgOrder = shuffle([...selected]);

const animalList = document.getElementById("animals");
const imageDiv = document.getElementById("images");

wordOrder.forEach(item => {
    let li = document.createElement("li");
    li.textContent = item.ar;
    li.id = item.en;
    li.draggable = true;
    li.addEventListener('dragstart', (e) => e.dataTransfer.setData("text", e.target.id));
    
    // Mobile Touch Events
    li.addEventListener('touchstart', handleTouchStart, false);
    li.addEventListener('touchmove', handleTouchMove, false);
    li.addEventListener('touchend', handleTouchEnd, false);
    
    animalList.appendChild(li);
});

imgOrder.forEach(item => {
    let img = document.createElement("img");
    img.src = item.en + ".jpg";
    img.id = item.en + "target";
    img.addEventListener('dragover', (e) => e.preventDefault());
    img.addEventListener('drop', handleDrop);
    imageDiv.appendChild(img);
});

let correctCount = 0;

function handleDrop(e) {
    e.preventDefault();
    let draggedId = e.dataTransfer.getData("text");
    checkMatch(draggedId, e.target);
}

function checkMatch(draggedId, targetElement) {
    if (targetElement.id === draggedId + "target") {
        targetElement.style.border = "8px solid green";
        document.getElementById(draggedId).style.visibility = "hidden";
        document.getElementById("myAudio").play();
        correctCount++;
        if(correctCount === 4) setTimeout(() => location.reload(), 2000);
    } else {
        targetElement.style.border = "8px solid red";
        document.getElementById("myAudio2").play();
    }
}

// Touch Handling Logic
let activeItem = null;

function handleTouchStart(e) {
    activeItem = e.target;
}

function handleTouchMove(e) {
    e.preventDefault(); // Prevent scrolling
    let touch = e.touches[0];
    activeItem.style.position = 'absolute';
    activeItem.style.left = touch.pageX - 60 + 'px';
    activeItem.style.top = touch.pageY - 30 + 'px';
}

function handleTouchEnd(e) {
    let touch = e.changedTouches[0];
    activeItem.style.display = 'none'; // Temporarily hide to find element underneath
    let dropTarget = document.elementFromPoint(touch.clientX, touch.clientY);
    activeItem.style.display = 'block';
    activeItem.style.position = 'static';

    if (dropTarget && dropTarget.tagName === 'IMG') {
        checkMatch(activeItem.id, dropTarget);
    }
}
</script>
</body>
</html>
